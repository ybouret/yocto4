\documentclass[aps]{revtex4}
\usepackage{graphicx}
\usepackage{amssymb,amsfonts,amsmath,amsthm}
\usepackage{chemarr}
\usepackage{bm}
\usepackage{bbm}
\usepackage{pslatex}
\usepackage{mathptmx}
\usepackage{xfrac}

\newcommand{\mymat}[1]{\bm{#1}}
\newcommand{\mytrn}[1]{~^{\mathsf{T}}{#1}}
\newcommand{\mygrad}{\vec{\nabla}}

\begin{document}
\title{Chemical Solutions}

\section{Description}
Let us assume that we have $A_1,\ldots,A_M$ chemical species coupled by
$N$ equilibria such that
\begin{equation}
	\forall i \in [1;N], \;\; \sum_{j=1}^{M} \nu_{i,j} C_i = 0, \;\; K_i(t) = \prod_{i=1}^{M} C_i^{\nu_{i,j}}.
\end{equation}
We remove the singularities by assuming that the equilibria are met when
\begin{equation}
	\forall i \in [1;N], \;\; \Gamma_i(t,\vec{C}) = K_i(t) \prod_{\nu_{i,j}<0}  C_i^{-\nu_{i,j}} -  \prod_{\nu_{i,j}>0} C_i^{\nu_{i,j}} 
\end{equation}
or
\begin{equation}
	\vec{\Gamma}(t,\vec{C}) = \vec{0}.
\end{equation}
We also naturally have the topology matrix $\mymat{\nu}$.

\section{Acceptable Extent}
Each reaction, depending on the initial concentrations, may have a maximum extent in the forward and/or the reverse way.
A negative or zero concentration blocks one way. The equilibrium is blocked when both ways are blocked.
In any case, each equilibrium imposes a range of valid extent.
Any chemical transformation is deduced from $\vec{C}$ and a chemical extent $\vec{\xi}$ by
$$
	\vec{C} + \mytrn{\mymat{\nu}}\vec{\xi}.
$$

\section{Validation a set of concentration}
A trial concentration vector $\vec{C}_k$ may be invalid: an \textbf{active} species (namely a species involved in an equilibria)
may be negative. In that case, we must look for the minimal extent that brings back the concentrations to a valid set, if that
is possible.
Let $Q$ be the number of online (aka not blocked) reactions, corresponding to the online $Q\times M$ topology $\mymat{\nu}'$
and to the online $Q$-dimensional extent $\vec{\xi}'$. We also have a set of $B$ 'bad' concentrations (active and negative) $\vec{C}'$.
Thus we search $\vec{\xi}'$ such that
$$
	\vec{C}' + \mymat{\beta} \vec{\xi}' = \vec{0}
$$
where $\beta$ is a $B\times Q$ matrix corresponding to a sub-matrix of $\mytrn{\mymat{\nu}}$.
We can this this last vectorial equation as a set of $B$ constraints. This we define a set
$\vec{\lambda}$ of $B$ Lagrange multipliers and we minimise
$$
	\dfrac{1}{2} \vec{\xi}^2 - \vec{\lambda}\cdot\left(\vec{C}' + \mymat{\beta} \vec{\xi}'\right)
$$
	

%Hence, we build the \textit{target concentration vector}
%$$
%	\vec{C}'_k
%$$
%with a zero value for the corresponding valid concentrations, and  the negative otherwise
%This defines a set of $N$ constraints
%$$
%	\vec{0} = \vec{C}'_k + \mytrn{\mymat{\nu}}\vec{\xi}_k.
%$$
%We introduce the vector of $N$ Lagrange multipliers $\vec{\lambda}_k$ to minimise
%$$
%	\dfrac{1}{2} \vec{\xi}^2 - \vec{\lambda}_k \cdot \left( \vec{C}'_k + \mytrn{\mymat{\nu}}\vec{\xi}\right)
%$$
%leading to a guess value of
%$$
%	\vec{\xi}'_k = \mymat{\nu}\vec{\lambda}_k
%$$
%defining
%$$
%	\vec{0} = \vec{C}'_k + \mytrn{\mymat{\nu}}\mymat{\nu}\vec{\lambda}_k
%$$




\section{Finding some equilibria}

Let us assume that we start from a valid but out-of-equilibrium state $\vec{C}$.
Then the system can evolve only by a $N$ dimensional chemical advancement $\vec{\xi}$
\begin{equation}
	\vec{C}_{eq} = \vec{C} + \mytrn{\mymat{\nu}}\vec{\xi}
\end{equation}
Starting from a value $\vec{C}_{k}$, the Newton algorithm yields
\begin{equation}
	\vec{0} = \vec{\Gamma}(t,\vec{C}_k) + \mymat{\Phi}(t,\vec{C}_k) \mytrn{\mymat{\nu}}\vec{\xi}_k
\end{equation}

\end{document}